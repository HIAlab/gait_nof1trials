---
title: "R Notebook"
# output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(dplyr)
library(ggplot2)
library(RColorBrewer)
source("../src/data_loader.R")

gait_parameter <- "stride_lengths"
experiment <- "cauchy_conjugate_left_foot_downsample_5"

file_names <- c(
  paste0("all_estimates_", gait_parameter, "_basic.csv"),
  paste0("all_estimates_", gait_parameter, "_basic_informed.csv"),
  paste0("all_estimates_", gait_parameter, "_basic_time_cov.csv"),
  paste0("all_estimates_", gait_parameter, "_basic_time_cov_informed.csv"),
  paste0("all_estimates_", gait_parameter, "_AR1.csv"),
  paste0("all_estimates_", gait_parameter, "_AR1_informed.csv")
)
model_names <- c(
  "Basic",
  "Basic (Informative)", 
  "Time Covariate",
  "Time Covariate (Informative)",
  "AR1",
  "AR1 (Informative)"
)

df_list <- list()
for (i in 1:length(file_names)) {
  folder_path <- file.path("..", "data", "processed", experiment)
  data_path <- file.path(folder_path, file_names[i])
  est_df <- readr::read_csv(data_path, col_names = T, show_col_types = FALSE)
  est_df$model <- model_names[i]
  
  df_list[[i]] <- est_df 
}
all_est_df <- bind_rows(df_list)
all_est_df <- all_est_df[!(all_est_df$parameter == "deviance"), ]  # remove deviance from the plot

p <- ggplot(
  data = all_est_df, 
  aes(x=parameter, y=mean)) + 
  geom_boxplot(aes(fill=as.factor(model))) + 
  geom_point(aes(y=mean, group=model), position = position_dodge(width=0.75)) + 
  guides(fill=guide_legend(title="Likelihood Model")) + 
  ggtitle(paste0(gait_parameter, " posterior from all 16 subjects"))
p + facet_wrap( ~ parameter, scales="free")

p <- ggplot(
  data = all_est_df, 
  aes(x=parameter, y=sd)) + 
  geom_boxplot(aes(fill=as.factor(model))) + 
  geom_point(aes(y=sd, group=model), position = position_dodge(width=0.75)) + 
  guides(fill=guide_legend(title="Likelihood Model")) + 
  ggtitle(paste0(gait_parameter, " posterior from all 16 subjects"))
p + facet_wrap( ~ parameter, scales="free")
```

```{r}
library(readr)
# for (model in c("AR1", ))
# all_est_AR1 <- all_est_df %>% filter(model=="AR1") 
# all_est_default <- all_est_df %>% filter(model=="Default") 
# all_est_time_cov <- all_est_df %>% filter(model=="Time Covariate") 

# names(df)[names(df) == var] <- "var"
for (model_param in c("beta[1]", "beta[2]", "beta[3]", "beta[4]")) {
  all_est_df %>% 
  filter(parameter==model_param)  %>%
  group_by(model) %>%
  summarize(
    n = length(mean),
    mean = mean(mean),
    sd = sd(mean)
    ) %>%
  as.data.frame(.) %>% 
  mutate_if(is.numeric, round, 4) %>%
  print()
}

# get real data
all_strides_df <- read_csv(file.path("..", "data", "processed", "means.csv"), show_col_types = FALSE)
all_strides_df <- all_strides_df[c(gait_parameter, "fatigue", "condition")]
beta1 <- all_strides_df %>% filter(fatigue==0, condition==0)
beta2 <- all_strides_df %>% filter(fatigue==0, condition==1) - beta1
beta3 <- all_strides_df %>% filter(fatigue==1, condition==0) - beta1
beta4 <- all_strides_df %>% filter(fatigue==1, condition==1) - beta1 - beta2 - beta3
for (beta in list(beta1, beta2, beta3, beta4)) {
  print(mean(beta[[gait_parameter]]))
}
# print("Mean observed data for beta[1]:")
# print(mean(st_control_df[[gait_parameter]]))

```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

